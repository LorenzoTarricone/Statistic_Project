---
title: "Final Paper"
author: "Karim Abdel Sadek, Lorenzo Tarricone"
date: "1/6/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
Life-Expectancy has constantly increased over the last centuries, and it has never been so high as nowadays. Medicine has make great strides, eradicating and finding cures for a lot of mortal diseases. Perhaps, there are still others big challenges that we have to face up to, and one of those is cancer. Cancer is a leading cause of death all over the world, accounting for almost 10 milion deaths in 2020 (https://www.who.int/news-room/fact-sheets/detail/cancer). This is the reason why we thought that would be very interesting to analyze the principal factors that causes this disease, taking in consideration some macro-groups of variables: environment, life-style and socioeconomic/demographic condtions. We will try using the statistical tools to carry out this study. First we will buil the data set using a union of data we find, and to summarize them in a unique one. In this way we will have data coming from more than 150 countries over 25 year, helping us to conduct our statistical research. After that, and some data cleaning (that will be necessary) we will perform a multivariate linear regression, and trying to drive out some conclusion from that result. After that, for the part of testing we will carry on a model selection, using the step-down and the step-up method: we prefer those 2 since we don't have a huge number of covariates trying to explain our data, and thus those model are prefered. We will then take the conclusion, indicating the limitations of our study and extrapolating what we learned during the realization of this experiment

##Dataset and Data Cleaning
EXPLAIN HOW YOU CONSTRUCTED THE DATASET, WHERE WE HAVE TAKEN IT , WE WE CHOOSE IT, AND THEN LEAVE BELOW THOSE DESCRIPTION OF THE VARIABLES
#### Description of the variables

**Cancer**: Share of total population with any form of cancer, measured as the age-standardized percentage. This
share has been age-standardized assuming a constant age structure to compare prevalence between
countries and through time.

**Air_pollution**: Population-weighted average level of exposure to concentrations of suspended
particles measuring less than 2.5 microns in diameter (PM2.5).
Exposure is measured in micrograms of PM2.5 per cubic metre (µg/m³).

**Alcool**: Average per capita consumption of alcoholic beverages, measured in kilograms per
year. Data is based on per capita food supply at the consumer level, but does not
account for food waste at the consumer level

**GDP per capta**: Measured in constant international-$

**Obesity**: Obesity is defined as having a body-mass index (BMI) equal to or greater than 30. BMI is a person's
weight in kilograms divided by his or her height in metres squared

**Old age Dependency**: This is the ratio of the number of people older than 64 relative to the
number of people in the working-age (15-64 years). Data are shown as
the proportion of dependents per 100 working-age population.

**Smoking**: Share of population who smoke every day
```{r}
library(readr) #Used to read the csv
library(tidyverse) #Contains a lot of useful packages to clean the datas
library(gganimate) #To create animated plots
library(ggthemes) #To select some nice themes 
library(zoo) #To fill the N.A. values 
library(grid) #To display plots into a grid
library(gridExtra) #To display plots into a grid

Cancer <- read_csv("Datasets/Cancer.csv")
Air_pollution <- read_csv("Datasets/Air pollution.csv")
Alcool <- read_csv("Datasets/Alcool.csv")
GDP_per_capta <- read_csv("Datasets/GDP per capta.csv")
Obesity <- read_csv("Datasets/Obesity.csv")
Old_age_dependency_ratio <- read_csv("Datasets/Old age dependency ratio.csv")
Smoking <- read_csv("Datasets/Smoking.csv")
Population <- read_csv("Datasets/population-since-1800.csv")
countryContinent <- read_csv("Datasets/countryContinent.csv")
```
 
We proceed by taking the explanatory variable data set (Cancer) and adding the covariates as columns other columns, to do that we use the use the libraby "dplyr" as it makes it very easy to do and readable

```{r}
Continent = countryContinent %>% select(country, continent)
Continentt = rename(Continent, Entity = country)
Cancer1 = left_join(Cancer, Air_pollution, by = c("Entity", "Code", "Year"))
Cancer2 = left_join(Cancer1, Alcool, by = c("Entity", "Code", "Year"))
Cancer3 = left_join(Cancer2, GDP_per_capta, by = c("Entity", "Code", "Year"))
Cancer4 = left_join(Cancer3, Obesity, by = c("Entity", "Code", "Year"))
Cancer5 = left_join(Cancer4, Old_age_dependency_ratio, by = c("Entity", "Code", "Year"))
Cancer6 = left_join(Cancer5, Smoking, by = c("Entity", "Code", "Year"))
Cancer7 = left_join(Cancer6, Continentt, by = "Entity")
Cancer_final = Cancer7

rm("Cancer1", "Cancer2", "Cancer3", "Cancer4", "Cancer5", "Cancer6", "Cancer7")
rm("Air_pollution", "Alcool", "Cancer", "GDP_per_capta", "Obesity", "Old_age_dependency_ratio", "Smoking", "Continent", "Continentt")
```

We now proceed by renaming the columns. This will make all the manipulations of the dataframe more readable:

```{r}
colnames(Cancer_final)[4] <- "Cancer"
colnames(Cancer_final)[5] <- "AirPoll"
colnames(Cancer_final)[6] <- "Alcool"
colnames(Cancer_final)[7] <- "GDP"
colnames(Cancer_final)[8] <- "Obesity"
colnames(Cancer_final)[9] <- "Age"
colnames(Cancer_final)[10] <- "Smoking"
```

Here is what the final dataset looks like:

```{r, echo= FALSE}
Cancer_final
write.csv(Cancer_final, "Cancer_final.csv", row.names=FALSE, quote=FALSE) #to save the file into our environment
```
LET'S SEE IF IT IS NECESSARY TO LEAVE ALL THIS CODE IN THE PDF, WOULD BE NICE JUST TO EXPLAIN HOW THE DATA CLEANING HAS BEEN CARRIED OUT
WRITE NA.OMIT HERE

## Multivariate Linear Regression
We are now going to perform a multivariate linear regression, trying to examine the relationship between some explanatory variable and one response variable. Regarding our case, we are going to take in consideration as explanatory variables some factors belonging to various categories that we considered interesting to analyze and to help us to find some interesting correlation with the number of people affected by cancer worldwide. We decided to use data of approximately 150 countries, for approximately 20 years. In this way we will be able to do not miss some trend or to do not being deceived from some outliers years or random trends. Coming back to the explanatory variables they are divided in 3 categories, each one with some sub-categories: environment(Air Pollution), lifestyle(Smoking, Obesity, Alcohol), socioeconomic/demographic condition (GDP of the country and Age). We are trying then to see which of these variables explain better the data that we have. Before performing the actual linear regression, let’s analyze the data in a visual way, plotting the cancer cases against each of the covariates.



```{r}
mydata = read.csv("Cancer_final.csv")
data5 = na.omit(mydata)

plot(Cancer ~ Smoking, data=data3)

plot(Cancer ~ Age, data=data3)

plot(Cancer ~ Obesity, data=data3)

plot(Cancer ~ Alcool, data=data3)

plot(Cancer ~ GDP, data=data3)

plot(Cancer ~ AirPoll, data=data3)

#plot(Age ~ GDP, data=data3)
```

From this simple data visualization, we can see that we can identify some sort of relation between cancer cases and some of our explanatory variables, still as not strong as we imagined before doing those plots. We can see that age is the factor which presents a stronger correlation visually. Suprisingly air pollution seems to have a negative correlation, but we will dicuss this in the limitations of our study. We also have some outliers, which are Canada and US. Being cancer causes such a complicated and intricate thing, is actually quite difficult to really understand why those 2 countries have a such high number of cases. We can suppose that those two countries perform an more intense screening activity, but this goes beyond the scope of this study. We will just proceed to delete those two countries from our data set. Now, let’s proceed with the last step before performing the actual multiple linear regression: we will see if the assumptions on the data are met. Let’s check for the normality and for the homoscedasticity of the residuals.



```{r}

# Delete USA and Canada from the data set
data3 = subset(data5, Entity != "USA" || Entity != "Canada")

#Normality of the residuals
model = lm( Cancer~ Smoking + Obesity + GDP + Age + AirPoll + Alcool, data = data3)

#Perform Testing for normality of residuals
ols_test_normality(model)

#plot histogram of residuals
kop = residuals.lm(model)
hist(kop, breaks = 50)

#Check graphically using the function plot
plot(model)

```

 Let’s analyze each of the test we performed above, and let’s see which conclusion we can take from what we observed. About the model, we can see that the p-value of the tests we performed is low for all of them, thus we can reject the null hypothesis that the errors are normally distributed. This is exactly as we imagined: the data set is made by more or less  1000 data points, thus violating this assumption was something that we expected for. 
Instead, trying to see the situation graphically, the situations seems a bit better. The qq-plot shows that the data fit not that badly the diagonal line, exceptions made for a little deviation near the top. Analyzing furthermore one graph, we see that plot of the residuals against the fitted values approximate more or less a straight line. The residuals are thus not that bad, but if we want to be strict we will not be able to take out a strong conclusion from the experiment we will carry on.

Let’s now perform and interpret the result of the multiple linear regression.

```{r}
fit = lm( Cancer ~  Age + Smoking + GDP + Obesity + Alcool , data = data3)
fit
summary(fit)
```

From just these results, we can see various things: the value of the Adjusted R-Squared is satisfying, and then this model fits pretty well the data, telling us there is a quite good 
relationship with the covariates we indicated: our factors explain a 81% variation in cancer cases! We are actually considering the Adjusted R-Squared since we are performing a multivariate linear regression, and thus the number of factors we include in our model is relevant. In fact we know that the simply value of R-Squared can just increase when adding a factor, also if it is a completely random one.Also, all the variables seems to explain pretty well the number of cancer case: all of the p-values are statistically significant! We can see that wr have a stronger correlation for Age and GDP, as also our initial plots suggested.

## Model Selection
We start by importing the data we will need for the model selection and loading some useful libraries. We will then create our linear model 

```{r}
library(olsrr) #This stands for Ordinary Least SquaRe Regression and it has the tools needed
Cancermodelsel = read.csv("Cancer_final_noNA.csv")
model = lm( Cancer ~ Smoking + Obesity + GDP + Age + AirPoll + Alcool, data = data3)
summary(model)
```

Using testing methods we proceed with a Step-up method:

```{r}
frwfit <- ols_step_forward_p(model, pent = 0.05)
frwfit
```

The selection led us to retain all our covariates but the one about Smoke. To cross check it, let's use the symmetrical method, the Step-down method:

```{r}
bkwfit <- ols_step_backward_p(model, prem = 0.05)
bkwfit
```

As you can see we got the same result here.  
To do one last check using testing methods we use a mixed method to allow variables that were added in previous steps to be excluded in succeding steps (this wasn't allowed in the simple forward/step-up method)

```{r}
bothfit <- ols_step_both_p(model, pent = 0.05, prem = 0.05)
bothfit
```
But this again yield the same result as the one we got with the step foreward method. This seems to suggest a model of four variables that is cutting our Smoking and Obesity as these two risk factor are removed by all three of our greedy methods.

##Limitations of the study

##Conclusions
Based on the results of our study, we can conclude that our model explains quite well the variance in the data, and that we are able to conclude that various factors prevales in the increasing of cancer cases in a country. Older and richer countries (a thing that overlaps often) presents a lot of cancer cases, as countries with an higher consumption of alcohol and cigarettes above the mean. However, our study has a lot of limitations that we have to indicate. First, as we have to construct the data set by our own, lead to some difficulties: we joined some data sets toghether into a table, but obviously we had some missing data : it is not easy to have the data for all the countries for more than 25 year for all those factors. Also, countries with more missing datas are not random, but it depends on the lack of statistical capacity that they encounter about those various problems, and as expected there was a redundancy in the countries with missing data, altering a bit the " equilibrium" of our data. Besides that, we have taken into considerations just 6 factors to try to explain cancer incidence, but as we know it is a much more difficult research question: heritage, other factors of the lifestyle, other environmental element, access to the healthcare system, prevention of the country and a lot more plays a role in developing a cancer or not. Also, it is not an 'immediate' disease: factors of risk sum up over the years, as the evolution of medicine, and thus end up in a complicated and intricate situation to analyze. Diving in into some details, we also had a quite surprising result : the correlation between cancer cases and air pollution seems strongly negative, from the plot we see. It is difficult to explain such a result, but it may be that since the worst quality of air is in less developed countries(eg. Nigeria, Pakistan, India...), it may be that other factors as the age of the population or GDP, that are low values in those country typically, has a more stronger influence on the actual number of cancer cases, ending in this counter-intuitive
result.



##BIBlIOGRAPHY AND REFERENCES
https://www.who.int/news-room/fact-sheets/detail/cancer
https://it.u-earth.eu/post/the-world-s-most-and-least-polluted-countries

The sources used for the datas are:

- Cancer -> [Global Burden of Disease Collaborative Network. Global Burden of Disease Study 2017 (GBD 2017) Results. Seattle, United States: Institute for Health Metrics and Evaluation (IHME), 2018](http://ghdx.healthdata.org/gbd-results-tool)
- Air_pollution -> [World Development Indicators - World Bank ](http://data.worldbank.org/data-catalog/world-development-indicators)
- Alcool -> [Food and Agriculture Organization of the United Nations (FAO) (2017)](http://www.fao.org/faostat/en/?#data/)
- GDP_per_capta -> [World Development Indicators - World Bank ](http://data.worldbank.org/data-catalog/world-development-indicators)
- Obesity -> [World Health Organization (WHO)](http://apps.who.int/gho/data/view.main.REGION2480A?lang=en)
- Old_age_dependency -> [World Development Indicators - World Bank](http://data.worldbank.org/data-catalog/world-development-indicators)
- Smoking -> [Nationally representative sources, survey data](http://ghdx.healthdata.org/record/global-smoking-prevalence-and-cigarette-consumption-1980-2012)