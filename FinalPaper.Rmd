---
title: "Final Paper"
author: "Karim Abdel Sadek, Lorenzo Tarricone"
date: "1/6/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
Life-Expectancy has constantly increased over the last centuries, and it has never been so high as nowadays. Medicine has make great strides, eradicating and finding cures for a lot of mortal diseases. Perhaps, there are still other big challenges that we have to face up to, and one of those is cancer. Cancer is a leading cause of death all over the world, accounting for almost 10 milion deaths in 2020 (https://www.who.int/news-room/fact-sheets/detail/cancer). This is the reason why we thought that would be very interesting to analyze the principal factors that causes this disease, taking in consideration some macro-groups of variables: environment, life-style and socioeconomic/demographic condtions. 

##Dataset and Data Cleaning
EXPLAIN HOW YOU CONSTRUCTED THE DATASET, WHERE WE HAVE TAKEN IT , WE WE CHOOSE IT, AND THEN LEAVE BELOW THOSE DESCRIPTION OF THE VARIABLES
#### Description of the variables

**Cancer**: Share of total population with any form of cancer, measured as the age-standardized percentage. This
share has been age-standardized assuming a constant age structure to compare prevalence between
countries and through time.

**Air_pollution**: Population-weighted average level of exposure to concentrations of suspended
particles measuring less than 2.5 microns in diameter (PM2.5).
Exposure is measured in micrograms of PM2.5 per cubic metre (µg/m³).

**Alcool**: Average per capita consumption of alcoholic beverages, measured in kilograms per
year. Data is based on per capita food supply at the consumer level, but does not
account for food waste at the consumer level

**GDP per capta**: Measured in constant international-$

**Obesity**: Obesity is defined as having a body-mass index (BMI) equal to or greater than 30. BMI is a person's
weight in kilograms divided by his or her height in metres squared

**Old age Dependency**: This is the ratio of the number of people older than 64 relative to the
number of people in the working-age (15-64 years). Data are shown as
the proportion of dependents per 100 working-age population.

**Smoking**: Share of population who smoke every day
```{r}
library(readr) #Used to read the csv
library(tidyverse) #Contains a lot of useful packages to clean the datas
library(gganimate) #To create animated plots
library(ggthemes) #To select some nice themes 
library(zoo) #To fill the N.A. values 
library(grid) #To display plots into a grid
library(gridExtra) #To display plots into a grid

Cancer <- read_csv("Datasets/Cancer.csv")
Air_pollution <- read_csv("Datasets/Air pollution.csv")
Alcool <- read_csv("Datasets/Alcool.csv")
GDP_per_capta <- read_csv("Datasets/GDP per capta.csv")
Obesity <- read_csv("Datasets/Obesity.csv")
Old_age_dependency_ratio <- read_csv("Datasets/Old age dependency ratio.csv")
Smoking <- read_csv("Datasets/Smoking.csv")
Population <- read_csv("Datasets/population-since-1800.csv")
countryContinent <- read_csv("Datasets/countryContinent.csv")
```
 
We proceed by taking the explanatory variable data set (Cancer) and adding the covariates as columns other columns, to do that we use the use the libraby "dplyr" as it makes it very easy to do and readable

```{r}
Continent = countryContinent %>% select(country, continent)
Continentt = rename(Continent, Entity = country)
Cancer1 = left_join(Cancer, Air_pollution, by = c("Entity", "Code", "Year"))
Cancer2 = left_join(Cancer1, Alcool, by = c("Entity", "Code", "Year"))
Cancer3 = left_join(Cancer2, GDP_per_capta, by = c("Entity", "Code", "Year"))
Cancer4 = left_join(Cancer3, Obesity, by = c("Entity", "Code", "Year"))
Cancer5 = left_join(Cancer4, Old_age_dependency_ratio, by = c("Entity", "Code", "Year"))
Cancer6 = left_join(Cancer5, Smoking, by = c("Entity", "Code", "Year"))
Cancer7 = left_join(Cancer6, Continentt, by = "Entity")
Cancer_final = Cancer7

rm("Cancer1", "Cancer2", "Cancer3", "Cancer4", "Cancer5", "Cancer6", "Cancer7")
rm("Air_pollution", "Alcool", "Cancer", "GDP_per_capta", "Obesity", "Old_age_dependency_ratio", "Smoking", "Continent", "Continentt")
```

We now proceed by renaming the columns. This will make all the manipulations of the dataframe more readable:

```{r}
colnames(Cancer_final)[4] <- "Cancer"
colnames(Cancer_final)[5] <- "AirPoll"
colnames(Cancer_final)[6] <- "Alcool"
colnames(Cancer_final)[7] <- "GDP"
colnames(Cancer_final)[8] <- "Obesity"
colnames(Cancer_final)[9] <- "Age"
colnames(Cancer_final)[10] <- "Smoking"
```

Here is what the final dataset looks like:

```{r, echo= FALSE}
Cancer_final
write.csv(Cancer_final, "Cancer_final.csv", row.names=FALSE, quote=FALSE) #to save the file into our environment
```
LET'S SEE IF IT IS NECESSARY TO LEAVE ALL THIS CODE IN THE PDF, WOULD BE NICE JUST TO EXPLAIN HOW THE DATA CLEANING HAS BEEN CARRIED OUT

## Multivariate Linear Regression
We are now going to perform a multivariate linear regression, trying to examine the relationship between some explanatory variable and one response variable. Regarding our case, we are going to take in consideration as explanatory variables some factors belonging to various categories that we considered interesting to analyze and to help us to find some interesting correlation with the number of people affected by cancer worldwide. We decided to use data of approximately 150 countries, for approximately 20 years. In this way we will be able to do not miss some trend or to do not being deceived from some outliers years or random trends. Coming back to the explanatory variables they are divided in 3 categories, each one with some sub-categories: environment(Air Pollution), lifestyle(Smoking, Obesity, Alcohol), socioeconomic/demographic condition (GDP of the country and Age). We are trying then to see which of these variables explain better the data that we have. Before performing the actual linear regression, let’s analyze the data in a visual way, plotting the cancer cases against each of the covariates.



```{r}
mydata = read.csv("Cancer_final.csv")
data3 = na.omit(mydata)

plot(Cancer ~ Smoking, data=data3)

plot(Cancer ~ Age, data=data3)

plot(Cancer ~ Obesity, data=data3)

plot(Cancer ~ Alcool, data=data3)

plot(Cancer ~ GDP, data=data3)

plot(Cancer ~ AirPoll, data=data3)

#plot(Age ~ GDP, data=data3)
```

From this simple data visualization, we can see that we can identify some sort of relation between cancer cases and some of our explanatory variables, still as not strong as we imagined before doing those plots. We can see that age is the factor which presents a stronger correlation visually. We also have some outliers, which are Canada and US, but we will analyze this further in the limitation of our study. Now, let’s proceed with the last step before performing the actual multiple linear regression: we will see if the assumptions on the data are met. Let’s check for the normality and for the homoscedasticity of the residuals.



```{r}
#Normality of the residuals
model = lm( Cancer~ Smoking + Obesity + GDP + Age + AirPoll + Alcool, data = data3)
#ols_plot_resid_qq(model)
fit2 = lm(Cancer ~ AirPoll, data = data3)
summary(fit2)

ols_test_normality(model)
#ols_test_correlation(model)
## [1] 0.8482072
#ols_plot_resid_hist(model)
kop = residuals.lm(model)
hist(kop, breaks = 50)


#homoscedasticity of the residuals
plot(model)

```

 Let’s analyze each of the test we performed above, and let’s see which conclusion we can take from what we observed. About the model, we can see that the p-value of the tests is low for all of them, thus we can reject the null hypothesis that the errors are normally distributed. Also, for what concern the correlation between observed residuals and expected residuals under normality, the value is satisfactory to assume a strong correlation. The qq-plot shows that the data fit pretty well the diagonal line, exceptions made for a little deviation near the top. Lastly, to check the homoscedasticity we see the plots produced by the function plot(model). All the plots presents a satisfactory result, thus we can conclude that the assumption about homoscedasticity of the result is respected.

Let’s now perform and interpret the result of the multiple linear regression.

```{r}
mydata = read.csv("Cancer_final.csv")
data3 = na.omit(mydata)

#plot(AirPoll~Obesity, data=data3)
fit = lm( Cancer ~  Age + Smoking + GDP + Obesity + Alcool , data = data3)
fit

summary(fit)
```

From just these results, we can see various things: the value of the Adjusted R-Squared is satisfying, and then this model fits pretty well the data, telling us there is a quite good linear relationship. Also, all the variables seems to explain pretty well the number of cancer case: all of the p-values are statistically significant! The value that more explain our variable is the Age(not surprisingly I would say). On the other hand, if we try for example just to consider data coming from just one year, the results are pretty surprising


```{r}
data4 = subset(data3, Year == "2005")
fit2 = lm( Cancer ~ Alcool + GDP + Obesity + Age + Smoking + AirPoll, data = data4)
fit2

summary(fit2)

#fin = subset(mydata, select = c(Entity,Year,Cancer,Smoking))
#fan = na.omit(fin)
#fit2 = lm (Cancer ~ Smoking, data= fin)
#fit2
#summary(fit2)
#plot(Cancer ~ Smoking, data=fin)
#abline(fit2, col="blue", lwd=2)


```

In this case it seems that some of the variables do not correlate well! We can try the conclusion that the subset of the dataset we are considering ( just one year ) is not satisfying to take some satisfactory conclusion. This makes perfectly sense considering the context we are working on, since we should take in consideration also the time dependence. `Let’s take an extreme case as an example: if all of the population of a country starts to smoke instantaneously, the cancer cases for some years will remain quite constant, and if analyzing the data relating to just a short period of time, you would see that there is not a positive correlation between cancer and smoking, which does not make any sense! This test that we just carried out was just a demonstration of the fact that we should be very careful to draw conclusions instinctively.

## Model Selection
We start by importing the data we will need for the model selection and loading some useful libraries. We will then create our linear model 

```{r}
library(olsrr) #This stands for Ordinary Least SquaRe Regression and it has the tools needed
Cancermodelsel = read.csv("Cancer_final_noNA.csv")
model = lm( Cancer ~ Smoking + Obesity + GDP + Age + AirPoll + Alcool, data = data3)
summary(model)
```

Using testing methods we proceed with a Step-up method:

```{r}
frwfit <- ols_step_forward_p(model, pent = 0.05)
frwfit
```

The selection led us to retain all our covariates but the one about Smoke. To cross check it, let's use the symmetrical method, the Step-down method:

```{r}
bkwfit <- ols_step_backward_p(model, prem = 0.05)
bkwfit
```

As you can see we got the same result here.  
To do one last check using testing methods we use a mixed method to allow variables that were added in previous steps to be excluded in succeding steps (this wasn't allowed in the simple forward/step-up method)

```{r}
bothfit <- ols_step_both_p(model, pent = 0.05, prem = 0.05)
bothfit
```
But this again yield the same result as the one we got with the step foreward method. This seems to suggest a model of four variables that is cutting our Smoking and Obesity as these two risk factor are removed by all three of our greedy methods.

##Limitations of the study


##Conclusions





##BIBlIOGRAPHY AND REFERENCES
https://www.who.int/news-room/fact-sheets/detail/cancer
The sources used for the datas are:

- Cancer -> [Global Burden of Disease Collaborative Network. Global Burden of Disease Study 2017 (GBD 2017) Results. Seattle, United States: Institute for Health Metrics and Evaluation (IHME), 2018](http://ghdx.healthdata.org/gbd-results-tool)
- Air_pollution -> [World Development Indicators - World Bank ](http://data.worldbank.org/data-catalog/world-development-indicators)
- Alcool -> [Food and Agriculture Organization of the United Nations (FAO) (2017)](http://www.fao.org/faostat/en/?#data/)
- GDP_per_capta -> [World Development Indicators - World Bank ](http://data.worldbank.org/data-catalog/world-development-indicators)
- Obesity -> [World Health Organization (WHO)](http://apps.who.int/gho/data/view.main.REGION2480A?lang=en)
- Old_age_dependency -> [World Development Indicators - World Bank](http://data.worldbank.org/data-catalog/world-development-indicators)
- Smoking -> [Nationally representative sources, survey data](http://ghdx.healthdata.org/record/global-smoking-prevalence-and-cigarette-consumption-1980-2012)